<!DOCTYPE html>
<head>
<title>!!!</title>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/dygraphs@2.2.1/dist/dygraph.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://unpkg.com/dygraphs@2.2.1/dist/dygraph.min.css" />

<style type="text/css">
    #graph {
      position: absolute;
      left: 10px;
      right: 10px;
      top: 10px;
      bottom: 20%;
    }

    #json {
      position: absolute;
      bottom: 10%;
      left: 50%;
      right: 50%;
    }

</style>
</head>
<body>
<div id="graph"></div>
<div id="json">json</div>

<script>

console.log(String(new Date()));
let grafdata = [[new Date(), 15]];

        //for at grafen skal huske kor musa var nÃ¥r den blir updated
        var last_mousemove_evt = null;
        var on_graph = false;

        g = new Dygraph(document.getElementById("graph"), grafdata, {
            animatedZooms: true,
            title: 'dygraphs ' + Dygraph.VERSION + ' chart template',
            labels: ["tid","verdi"],

            //minne for mus
            highlightCallback: function (e, x, pts, row) {
                last_mousemove_evt = e;
                on_graph = true
            },
            unhighlightCallback: function (e) {
                on_graph = false;
            }

        });


var id = '1h5NVjkJVEd7nCfP2H65_qVaOnB-r3XXiBnb5sQkgw2U';
var gid = '0';
var url = 'https://docs.google.com/spreadsheets/d/'+id+'/gviz/tq?tqx=out:json&tq&gid='+gid;
//https://docs.google.com/spreadsheets/d/1h5NVjkJVEd7nCfP2H65_qVaOnB-r3XXiBnb5sQkgw2U/edit#gid=0
fetch(url)
  .then(response => response.text())
  .then(data => document.getElementById("json").innerHTML=myItems(data.substring(47).slice(0, -2))  
  );
function myItems(jsonString){
  var json = JSON.parse(jsonString);
  console.log("json under her");
  console.log(json);
  var table = '<table><tr>'
  json.table.cols.forEach(colonne => table += '<th>' + colonne.label + '</th>')
  table += '</tr>'
  json.table.rows.forEach(ligne => {
    table += '<tr>'
    ligne.c.forEach(cellule => {
        try{var valeur = cellule.f ? cellule.f : cellule.v}
        catch(e){var valeur = ''}
        table += '<td>' + valeur + '</td>'
      }
    )
    table += '</tr>'
    }
  )
  table += '</table>'
  return table
}

</script>

</body>
</html>