<!DOCTYPE html>
<head>
<title>EOS</title>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/dygraphs@2.2.1/dist/dygraph.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://unpkg.com/dygraphs@2.2.1/dist/dygraph.min.css" />

<style type="text/css">
    #graph {
      position: absolute;
      left: 10px;
      right: 10px;
      top: 10px;
      bottom: 10px;
    }
/*
    #liste { 
    height: 40px;
    position: fixed; 
    bottom:10%;
    width:100%; 
}
*/
</style>
</head>
<body>
<div id="graph"></div>
<!--
<div id="liste"></div>
-->
<script>

grafdata = [[1]];
labels = ['a'];

g = new Dygraph(document.getElementById("graph"), grafdata, {
    animatedZooms: true,
    labels: ['a'],
    title: 'Temperatur fra Florida (yr)'
});

g.updateOptions({
'file': grafdata,
labels: labels
}); 

var id = '1h5NVjkJVEd7nCfP2H65_qVaOnB-r3XXiBnb5sQkgw2U';
var gid = '0';
var url = 'https://docs.google.com/spreadsheets/d/'+id+'/gviz/tq?tqx=out:json&tq&gid='+gid;
//https://docs.google.com/spreadsheets/d/1h5NVjkJVEd7nCfP2H65_qVaOnB-r3XXiBnb5sQkgw2U/edit#gid=0
fetch(url)
  .then(response => response.text())
  .then(data => myItems(data.substring(47).slice(0, -2))  
  );
function myItems(jsonString){
  var json = JSON.parse(jsonString);
  console.log("json object fra google:");
  console.log(json);

  labels = [];
  for (let i = 0; i < json.table.cols.length; i++) {
      labels.push(json.table.cols[i].label);
  } 
  console.log("labels henta fra json:");
  console.log(labels);

grafdata = [];
  for (let i = 0; i < json.table.rows.length; i++) { // [ [[0]:timestamp, [1]:value1, [2]value2 ... [N]valueN] , ... ]
    tmp=[];
    for (let j = 0; j < json.table.rows[i].c.length; j++){
      tmp.push(json.table.rows[i].c[j].v); // C er en array [0]:timestamp, [1]:value1, [2]value2 ... [N]valueN
    }
    grafdata.push(tmp);
    grafdata[i][0] = new Date(grafdata[i][0] * 1000); //må gjøre unix time om til date object
  }

  console.log("grafdata henta og konvertert fra json:");
  console.log(grafdata);

g.updateOptions({
'file': grafdata,
labels: labels
}); 
  
}



</script>

</body>
</html>